# GoFish Multiplayer

A real-time, multiplayer implementation of the classic card game **Go Fish**, built with **React Native** and **Expo**. This project serves as a **personal portfolio project** demonstrating full-stack mobile development using a serverless architecture.

## üåü Features

* **Real-time Multiplayer:** Leverages Supabase Realtime to synchronize game state, player hands, and moves across devices instantly.
* **Lobby System:** Create or join game rooms using unique 4-character codes.
* **Automated Game Engine:** A custom `useGameLoop` hook manages the complex rules of Go Fish, including asking for cards, drawing from the "ocean," and completing books.
* **Resilient Presence System:** Features a "Heartbeat" and "Reaper" mechanism to automatically clean up inactive players and handle host migration seamlessly.
* **Persistent Identity:** Uses Zustand with local storage to remember player names and IDs across sessions.
* **Responsive UI:** Built with NativeWind (Tailwind CSS) for a modern, mobile-first aesthetic.

## üõ†Ô∏è Tech Stack

* **Frontend:** React Native (Expo).
* **Backend/Database:** Supabase (PostgreSQL, Realtime, RPC).
* **State Management:** Zustand.
* **Styling:** NativeWind / Tailwind CSS.
* **Icons:** Material Community Icons.

## üöÄ Getting Started

### Prerequisites

* Node.js and npm/yarn.
* Expo Go app on your mobile device or an emulator.

### Installation

1. **Clone the repository:**
```bash
git clone https://github.com/Yahia-Raouf/GoFish
cd GoFish

```


2. **Install dependencies:**
```bash
npm install

```


3. **Environment Variables:**
Create a `.env` file in the root directory and add your Supabase credentials:
```env
EXPO_PUBLIC_SUPABASE_URL=your_supabase_url
EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

```


4. **Start the project:**
```bash
npx expo start

```



## üóÑÔ∏è Database Setup

To support the multiplayer logic, execute the following SQL in your Supabase SQL Editor:

### 1. Schema Definition

The game relies on three primary tables: `rooms` for game state, `players` for hands and scores, and `game_moves` for logging actions.

```sql
-- Create the ROOMS table
create table public.rooms (
  code text primary key,
  status text not null default 'WAITING' check (status in ('WAITING', 'PLAYING', 'FINISHED')),
  host_id uuid,
  turn_index int default 0,
  direction int default 1,
  ocean_cards jsonb default '[]'::jsonb,
  target_sets int default 5,
  winner_id uuid,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create the PLAYERS table
create table public.players (
  id uuid primary key default gen_random_uuid(),
  room_code text references public.rooms(code) on delete cascade not null,
  user_id uuid,
  name text not null,
  avatar text,
  seat_index int,
  cards jsonb default '[]'::jsonb,
  sets jsonb default '[]'::jsonb,
  is_ready boolean default false,
  last_seen timestamp with time zone default timezone('utc'::text, now()) not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Create the GAME_MOVES table
create table public.game_moves (
  id bigint generated by default as identity primary key,
  room_code text references public.rooms(code) on delete cascade not null,
  actor_id uuid references public.players(id) on delete cascade not null,
  action_type text not null check (action_type in ('ASK', 'FISH', 'CATCH', 'FAIL', 'SET_COMPLETE', 'WIN', 'LUCKY')),
  target_id uuid references public.players(id) on delete set null,
  rank_asked text,
  cards_transferred int default 0,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

```

### 2. RPC Functions & Security

Add the helper function to clean up rooms and enable basic Row Level Security.

```sql
-- RPC to wipe a specific room
create or replace function clean_room(target_code text)
returns void as $$
begin
  delete from public.rooms where code = target_code;
end;
$$ language plpgsql;

-- Enable RLS
alter table public.rooms enable row level security;
alter table public.players enable row level security;
alter table public.game_moves enable row level security;

-- Dev Mode Policies
create policy "Enable all access for rooms" on public.rooms for all using (true) with check (true);
create policy "Enable all access for players" on public.players for all using (true) with check (true);
create policy "Enable all access for game_moves" on public.game_moves for all using (true) with check (true);

```

### 3. Real-time Configuration

Ensure the tables are added to the `supabase_realtime` publication to enable live updates on devices.

```sql
alter publication supabase_realtime add table rooms;
alter publication supabase_realtime add table players;
alter publication supabase_realtime add table game_moves;

```

## üìÇ Project Structure

* **`/app/screens`**: Contains the primary views: `Welcome`, `Home`, and `GameRoom`.
* **`/components`**: UI building blocks including `ActiveGame` for gameplay and `LobbyView` for room management.
* **`/hooks`**: The "brain" of the app.
* `useGameLoop`: Orchestrates Go Fish logic and turn-based transitions.
* `useGameRoom`: Manages data subscriptions and player presence.
* `useLobby`: Handles room creation, joining, and status updates.
* **`/store`**: Zustand store for persisting player state.
* **`/utils`**: Generic Supabase database helpers.

## üéÆ Rules of the Game

This project implements the standard rules of Go Fish with several automated enhancements:

* **Starting the Game**: Players are dealt 7 cards each from a standard 52-card deck.
* **Asking**: On your turn, you must ask a specific opponent for a rank that you already hold in your hand.
* **Catching**: If the opponent has the requested rank, they must hand over all cards of that rank, and you get another turn.
* **Go Fish**: If the opponent has no cards of that rank, you must "Go Fish" and draw a card from the ocean.
* **Lucky Draw**: If you draw the exact rank you asked for, it is a "Lucky Draw," and you receive another turn.
* **Books (Sets)**: Once you collect all four cards of a single rank, they are automatically removed from your hand and added to your "Sets" (score).
* **Winning**: The game ends when all 13 books have been collected or the ocean is empty and players run out of cards.

## üß† Key Technical Challenges

* **Distributed State Management**: Synchronizing game turns and deck state across multiple devices without a centralized authoritative server required complex conditional logic in the `useGameLoop` hook to prevent race conditions during card transfers.
* **The "Reaper" Presence Pattern**: One of the biggest challenges was handling players who disconnect mid-game. I implemented a heartbeat system where each player updates a `last_seen` timestamp. A "Reaper" logic was then built into the room hook where the player with the lowest seat index (the effective host) identifies and removes "ghost" players who haven't sent a heartbeat for over 60 seconds.
* **Host Migration**: By using `seat_index` to determine the "effective host" rather than a static ID, the game can seamlessly continue even if the original room creator leaves, as the next available player automatically assumes administrative responsibilities.

## üöÄ Future Roadmap

* **Card Animations**: Implement `react-native-reanimated` to show cards physically flying from one player's hand to another during a "Catch" or from the ocean during a "Fish."
* **Global Chat**: Add a real-time chat component within the lobby and active game screens using Supabase's broadcast feature.
* **Sound Effects**: Integrate audio feedback for successful catches, "Go Fish" events, and completing a book.
* **Custom Avatars**: Allow players to upload or select custom avatars instead of the default emoji-based system.
